{% extends "adminpanel/base.html" %}
{% block title %}My Tasks{% endblock %}
{% block content %}
{% if messages %}{% for msg in messages %}<div class="alert alert-{{ msg.tags }}">{{ msg }}</div>{% endfor %}{% endif %}

<h2 class="mb-3">Manage Tasks</h2>

<!-- Create Task -->
<form method="post" class="card p-3 mb-4 shadow">
  {% csrf_token %}
  <div class="row g-2 align-items-center">
    <div class="col-md-3"><input type="text" name="title" placeholder="Task title" class="form-control" required></div>
    <div class="col-md-3"><input type="text" name="description" placeholder="Short description" class="form-control"></div>
    <div class="col-md-2"><input type="date" name="due_date" class="form-control"></div>
    <div class="col-md-2">
      <select name="assigned_to" class="form-select" required>
        <option value="">-- Assign to user --</option>
        {% for u in users %}
        <option value="{{ u.id }}">{{ u.username }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2"><button class="btn btn-success w-100">Create Task</button></div>
  </div>
</form>

<!-- Tasks Table -->
<table class="table table-striped shadow">
  <thead class="table-dark">
    <tr>
      <th>ID</th><th>Title</th><th>Assigned To</th><th>Due Date</th><th>Status</th><th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for task in tasks %}
    <tr>
      <td>{{ task.id }}</td>
      <td>{{ task.title }}</td>
      <td>{{ task.assigned_to.username }}</td>
      <td>{{ task.due_date }}</td>
      <td>{{ task.status }}</td>
      <td>
        <a class="btn btn-sm btn-primary" href="{% url 'edit_task' task.id %}">Edit</a>

        <form method="post" action="{% url 'delete_task' task.id %}" style="display:inline;">
          {% csrf_token %}
          <button class="btn btn-danger btn-sm" onclick="return confirm('Delete task?')">Delete</button>
        </form>

        {% if task.status == "Completed" %}
          <a class="btn btn-sm btn-info" href="{% url 'view_task_report' task.id %}">View Report</a>
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="6" class="text-center">No tasks found.</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
